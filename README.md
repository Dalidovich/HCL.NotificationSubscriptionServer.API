# HCL.NotificationSubscriptionServer.API

–°–µ—Ä–≤–∏—Å –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç–µ–π HCL. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–µ–π –∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Kafka.

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–ø–æ–¥–ø–∏—Å–∫–∏)
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kafka –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π
- OData API –¥–ª—è –≥–∏–±–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Elasticsearch

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- .NET 7
- PostgreSQL
- Kafka
- Docker
- OData
- JWT
- Elasticsearch + Serilog
- xUnit + FluentAssertions (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

1. **API** - –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ middleware
2. **BLL** - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
3. **DAL** - –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (Entity Framework Core)
4. **Domain** - –°—É—â–Ω–æ—Å—Ç–∏, DTO, enums

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker
- Docker Compose
- .NET 7 SDK (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
docker-compose up -d
```
### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ docker-compose.yml):  
- **`ConnectionStrings__NpgConnectionString`** - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL  
- **`KafkaSettings__BootstrapServers`** - –∞–¥—Ä–µ—Å Kafka —Å–µ—Ä–≤–µ—Ä–∞  
- **`KafkaSettings__Topic`** - —Ç–æ–ø–∏–∫ Kafka –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π  
- **`ElasticConfiguration__Uri`** - –∞–¥—Ä–µ—Å Elasticsearch –¥–ª—è –ª–æ–≥–æ–≤  
- **`JWTSettings:SecretKey`** - –∫–ª—é—á –¥–ª—è JWT  
- **`JWTSettings:Issuer`** - –∏–∑–¥–∞—Ç–µ–ª—å JWT  
- **`JWTSettings:Audience`** - –∞—É–¥–∏—Ç–æ—Ä–∏—è JWT  

## üìö API Endpoints
### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏ (Relationship)  
- **`POST /api/Relationship/v1/relationship`** - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ
- **`DELETE /api/Relationship/v1/relationship/account`** - –£–¥–∞–ª–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ (–¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞)
- **`DELETE /api/Relationship/v1/relationship/admin`** - –£–¥–∞–ª–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ (–¥–ª—è –∞–¥–º–∏–Ω–∞)
- **`GET /api/RelationshipOData/odata/v1/Relationship`** - OData –∑–∞–ø—Ä–æ—Å –æ—Ç–Ω–æ—à–µ–Ω–∏–π

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ (Notification)
- **`DELETE /api/Notification/v1/notification/account`** - –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞)
- **`DELETE /api/Notification/v1/notification/admin`** - –£–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–¥–ª—è –∞–¥–º–∏–Ω–∞)
- **`GET /api/NotificationOData/odata/v1/Notification`** - OData –∑–∞–ø—Ä–æ—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ (NotificationService, RelationshipService)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- –¢–µ—Å—Ç—ã –¥–ª—è KafkaConsumerService

### –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:
```bash
dotnet test
```
## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL —Å –¥–≤—É–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:  
- **relationships** - –•—Ä–∞–Ω–∏—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - account_master_id - ID –≤–µ–¥—É—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
  - account_slave_id - ID –≤–µ–¥–æ–º–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
  - relationship_status - —Å—Ç–∞—Ç—É—Å –æ—Ç–Ω–æ—à–µ–Ω–∏—è (Normal/Subscription)
- **notifications** - –•—Ä–∞–Ω–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - article_id - ID —Å—Ç–∞—Ç—å–∏
  - relationship_id - —Å–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π relationships  
–ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ CheckDBHostedService.

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –§–æ–Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è Kafka consumer –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å Elasticsearch
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OData –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Docker
